#!/bin/sh

tput civis

GREEN=$'\e[32m'
CYAN=$'\e[36m'
RESET=$'\e[0m'

# @see https://github.com/sindresorhus/cli-spinners/blob/main/spinners.json
SPINNER_STYLE="⠋⠙⠹⠸⠼⠴⠦⠧⠇⠏"

main() {
  prompt=$1

  while :; do
    jobs %1 > /dev/null 2>&1
    [ $? = 0 ] || {
      printf "\e[0;32m✔ \e[0m${prompt}\n"
      break
    }
    for (( i=0; i<${#SPINNER_STYLE}; i++ )); do
      sleep 0.08
      printf "\e[0;36m${SPINNER_STYLE:$i:1}${RESET}\e[0m ${prompt}\r"
    done
  done
}

$1 & main "${2-InProgress}"

tput cnorm


