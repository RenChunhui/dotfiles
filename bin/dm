#!/bin/sh
#
# macOS 管理工具

export BIN_NAME='dm'
export BIN_PATH=$HOME/.config/dotfiles

export BOLD=$'\e[1m'
export DIM=$'\e[2m'
export UNDERLINED=$'\e[4m'

export BLACK=$'\e[30m'
export RED=$'\e[31m'
export GREEN=$'\e[32m'
export YELLOW=$'\e[33m'
export BLUE=$'\e[34'
export MAGENTA=$'\e[95m'
export CYAN=$'\e[36m'
export WHITE=$'\e[97m'

export RESET=$'\e[0m'
export RESET_BOLD=$'\e[21m'
export RESET_DIM=$'\e[22m'

export ICON_ASK='?'
export ICON_INFO='➜'
export ICON_OK='✔'
export ICON_WARN='⚠'
export ICON_FAIL='✖'
export ICON_ARROR_RIGHT="❯"
export ICON_STEP='⧗'



#######################################
# 提示输入 sudo 密码
#######################################
prompt_sudo() {
  sudo -v
  while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &
}

#######################################
# 安装命令行工具
#######################################
xcode_install() {
  if ! xcode-select --print-path &> /dev/null; then
    xcode-select --install &> /dev/null;
  fi
}

#######################################
# 帮助
#######################################
usage() {
cat <<EOF
Usage: ${BIN_NAME} [command]

Commands:
  install       初使化安装
  uninstall     卸载
  clean         系统清理
  version       当前版本号
  help          帮助文档
EOF
}

#######################################
# 入口
#######################################
main() {
  case $1 in
    install)
      prompt_sudo
      xcode_install
      sh $BIN_PATH/commands/install "$2"
      ;;
    uninstall)
      sh $BIN_PATH/commands/uninstall "$2"
      ;;
    clean)
      sh $BIN_PATH/commands/clean "$2"
      ;;
    checkhealth)
      sh $BIN_PATH/commands/checkhealth
      ;;
    '' | h | help)
      usage
      ;;
    *)
      echo "The specified command is invalid. For a list of available
      options,run dm help."
      ;;
  esac
}

main "$@"
