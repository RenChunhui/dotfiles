#!/bin/sh
#
# 清理

source $HOME/.dotfiles/lib/foundation

# 清理日志
clean_log() {
  info "Clear System Log Files..."
  sudo rm -rfv /var/log/*
  sudo rm -rfv /private/var/log/*
  sudo rm -rfv /Library/Logs/*
}

# 清理缓存
clean_cache() {
  info 'Cleanup cache...'
  rm -rfv ~/Library/Caches/*

  if type "brew" &>/dev/null; then
    info 'Cleanup Homebrew Cache...'
    brew cleanup -s &>/dev/null
    brew cask cleanup &>/dev/null
    rm -rfv $(brew --cache) &>/dev/null
    brew tap --repair &>/dev/null
  fi

  if type "gem" &> /dev/null; then
    info 'Cleanup any old versions of gems'
    gem cleanup &>/dev/null
  fi

  if type "docker" &> /dev/null; then
    info 'Cleanup Docker'
    docker system prune -af
  fi

  if type "npm" &> /dev/null; then
    info 'Cleanup npm cache...'
    npm cache clean --force
  fi

  if type "yarn" &> /dev/null; then
    info 'Cleanup Yarn Cache...'
    yarn cache clean --force
  fi
}

case $1 in
  "" | "all")
    clean_log
    clean_cache
    ;;
  "log") clean_log
    ;;
  "cache") clean_cache
    ;;
  *)
    fail ""
    ;;
esac
